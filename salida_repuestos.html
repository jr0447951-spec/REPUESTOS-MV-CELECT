<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Repuestos Go! - Network Ops</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        :root {
            --brand: #4f46e5;
            --brand-light: #818cf8;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
            --success: #10b981;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at top left, #eef2ff 0%, #f8fafc 100%);
            color: var(--text);
            margin: 0; padding: 0;
            min-height: 100vh;
            display: flex; flex-direction: column;
        }

        header {
            padding: 25px 20px;
            text-align: center;
            background: var(--card-bg);
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        header h1 { 
            margin: 0; font-size: 1.4rem; color: var(--brand); 
            font-weight: 600;
        }

        .container { width: 90%; max-width: 450px; margin: 20px auto; flex: 1; }

        .timer-pill {
            background: var(--brand); color: white;
            padding: 6px 15px; border-radius: 20px;
            font-size: 0.8rem; font-weight: 600;
            display: inline-block; margin-bottom: 15px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.03);
        }

        label {
            display: block; margin-top: 15px;
            font-size: 0.75rem; font-weight: 600;
            color: #64748b; margin-left: 5px;
        }

        input {
            width: 100%; padding: 14px; margin-top: 6px;
            border-radius: 16px; border: 1.5px solid #e2e8f0;
            background: #f8fafc; color: var(--text);
            font-size: 1rem;
            box-sizing: border-box;
        }

        .readonly { background: #f1f5f9; color: #94a3b8; border-style: none; }

        .bodega-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 12px; margin-top: 8px;
        }

        .btn-bodega {
            background: #f1f5f9;
            border: 2px solid transparent;
            padding: 12px 5px;
            border-radius: 16px;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-bodega.selected {
            border-color: var(--brand);
            color: var(--brand);
        }

        .btn-send {
            width: 100%;
            padding: 18px;
            border-radius: 18px;
            background: linear-gradient(135deg, var(--brand), var(--brand-light));
            color: white;
            border: none;
            font-weight: 600;
            margin-top: 30px;
            cursor: pointer;
        }

        .suggestions {
            position: absolute;
            width: 100%;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }

        .suggestion-item {
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
        }

        .hidden { display: none; }
    </style>
</head>

<body>

<header>
    <div class="timer-pill" id="reloj">00:00:00</div>
    <h1>Registro de Salida</h1>
</header>

<div class="container">

<div class="card" id="consentimiento" style="text-align: center;">
    <div style="font-size: 3rem;">ðŸ“¦</div>
    <h2>Â¡Hola!</h2>
    <p style="color:#64748b;">Para registrar un repuesto necesitamos acceso para guardar tu foto de evidencia.</p>
    <button onclick="activar()" id="btnStart" disabled class="btn-send" style="background:#94a3b8;">Cargando inventario...</button>
    <div id="load-info">Sincronizando repuestos 2026...</div>
</div>

<form id="mainForm" class="hidden">
<div class="card">

<label>Nombre del TÃ©cnico</label>
<input type="text" id="tecnico" required>

<label>Â¿Desde quÃ© bodega retiras?</label>
<div class="bodega-grid">
<button type="button" class="btn-bodega" onclick="selectB(this,'SAN BENITO')">San Benito</button>
<button type="button" class="btn-bodega" onclick="selectB(this,'BODEGA CENTRAL')">Central</button>
<button type="button" class="btn-bodega" onclick="selectB(this,'TALNIQUE')">Talnique</button>
</div>
<input type="hidden" id="bodega" required>

<label>NÃºmero de Serie</label>
<input type="text" id="serie" required>

<!-- FOTO MODIFICADA -->
<label>Foto de la pieza</label>

<div style="display:flex; gap:10px; margin-top:8px;">
<button type="button" onclick="document.getElementById('fotoCamara').click()" class="btn-bodega">ðŸ“· Tomar Foto</button>
<button type="button" onclick="document.getElementById('fotoGaleria').click()" class="btn-bodega">ðŸ–¼ Subir Foto</button>
</div>

<input type="file" id="fotoCamara" accept="image/*" capture="environment" hidden>
<input type="file" id="fotoGaleria" accept="image/*" hidden>
<input type="file" id="foto" hidden required>

<div id="fotoInfo" style="margin-top:10px; font-size:0.8rem; color:#64748b;"></div>

<button type="submit" id="btnEnviar" class="btn-send">FINALIZAR REGISTRO</button>

</div>
</form>
</div>

<script>

const CONFIG = {
    URL_APPS_SCRIPT: 'https://script.google.com/macros/s/AKfycbz_Wv6DikTWQuqnAd9gMrjfEoFOFa9E9YdUuY5cSkr4ICqBKOo5WPvmJrhYF5_dv5fa/exec'
};

setInterval(()=>{
document.getElementById('reloj').innerText=
new Date().toLocaleTimeString("es-SV",{timeZone:"America/El_Salvador",hour12:false});
},1000);

function activar(){
document.getElementById('consentimiento').classList.add('hidden');
document.getElementById('mainForm').classList.remove('hidden');
}

function selectB(btn,v){
document.querySelectorAll('.btn-bodega').forEach(x=>x.classList.remove('selected'));
btn.classList.add('selected');
document.getElementById('bodega').value=v;
}

// FOTO
function manejarSeleccion(input){
const file=input.files[0];
if(!file)return;

if(file.size>5*1024*1024){
alert("La imagen supera 5MB.");
input.value="";
return;
}

const dt=new DataTransfer();
dt.items.add(file);
document.getElementById('foto').files=dt.files;

document.getElementById('fotoInfo').innerHTML=
"âœ… Foto lista: "+file.name+
"<br>Peso: "+(file.size/1024/1024).toFixed(2)+" MB";
}

document.getElementById('fotoCamara').addEventListener('change',function(){
manejarSeleccion(this);
});
document.getElementById('fotoGaleria').addEventListener('change',function(){
manejarSeleccion(this);
});

// ENVÃO ORIGINAL
document.getElementById('mainForm').onsubmit=async function(e){
e.preventDefault();

const file=document.getElementById('foto').files[0];
if(!file){
alert("Debes tomar o subir una foto.");
return;
}

const reader=new FileReader();
reader.onload=async()=>{
await fetch(CONFIG.URL_APPS_SCRIPT,{
method:'POST',
body:new URLSearchParams({
tecnico:document.getElementById('tecnico').value,
bodega:document.getElementById('bodega').value,
serie:document.getElementById('serie').value,
fileData:reader.result.split(',')[1],
fileName:file.name,
mimeType:file.type
})
});
alert("Registro enviado");
location.reload();
};
reader.readAsDataURL(file);
};

</script>

</body>
</html>

